<div class="sessions-container">
  <div class="sessions-header">
    <div class="title-section">
      <h2>–°–µ—Å—Å–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
      <span class="device-badge">{{ deviceId | slice:0:12 }}...</span>
    </div>
    <div class="header-actions">
      <div class="pagination">
        <button class="btn-icon" (click)="prevPage()" [disabled]="filter.offset === 0">‚Üê</button>
        <span class="page-info">–°—Ç—Ä. {{ (filter.offset / filter.limit) + 1 }} –∏–∑ {{ totalSessions ? (totalSessions/filter.limit) : 1 }}</span>
        <button class="btn-icon" (click)="nextPage()" [disabled]="(filter.offset + filter.limit) >= totalSessions">‚Üí</button>
      </div>
    </div>
  </div>

  <div class="sessions-toolbar">
    <div class="selection-info" [class.has-selection]="getSelectedCount() > 0">
      <span>–í—ã–±—Ä–∞–Ω–æ: {{ getSelectedCount() }}</span>
    </div>
    <div class="toolbar-actions">
      <button class="btn btn-outline" (click)="openDeleteModal('date')">
        <span>üóìÔ∏è</span> –£–¥–∞–ª–∏—Ç—å –ø–æ –¥–∞—Ç–µ
      </button>
      <button class="btn btn-danger" (click)="openDeleteModal('selected')" [disabled]="getSelectedCount() === 0">
        <span>üóëÔ∏è</span> –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ
      </button>
    </div>
  </div>

  <div class="sessions-table-container">
    <table class="sessions-table">
      <thead>
        <tr>
          <th style="width: 40px;">
            <input type="checkbox" 
                   [checked]="selectedSessionIds.size === sessions.length"
                   (change)="toggleAllSessions($event)">
          </th>
          <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
          <th>–ù–∞—á–∞–ª–æ</th>
          <th>–ö–æ–Ω–µ—Ü</th>
          <th>–í–µ—Ä—Å–∏—è</th>
          <th style="width: 40px;"></th>
        </tr>
      </thead>
      <tbody>
        @for (session of sessions; track session.id) {
          <tr [class.selected]="isSessionSelected(session)">
            <td>
              <input type="checkbox" 
                     [checked]="isSessionSelected(session)"
                     (change)="toggleSession(session.id)">
            </td>
            <td>
              <div class="user-info">
                <span class="user-avatar">{{ session.name.charAt(0).toUpperCase() }}</span>
                <span>{{ session.name }}</span>
              </div>
            </td>
            <td>{{ formatDate(session.startTime) }}</td>
            <td>{{ formatDate(session.endTime) }}</td>
            <td><span class="version-badge">{{ session.version }}</span></td>
            <td>
              <button class="btn-icon-small" (click)="toggleSession(session.id)">
                <span>‚ãÆ</span>
              </button>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="6" class="empty-message">
              <p>–°–µ—Å—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (showDeleteModal) {
    <div class="modal-overlay" (click)="cancelDelete()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
          <button class="close-btn" (click)="cancelDelete()">√ó</button>
        </div>
        <div class="modal-body">
          @if (deleteMode === 'date') {
            <div class="date-picker-group">
              <label>–£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏–∏ —Å—Ç–∞—Ä—à–µ –¥–∞—Ç—ã:</label>
              <input type="datetime-local" 
                     class="date-input"
                     [(ngModel)]="cleanupDate">
            </div>
          } @else if (deleteMode === 'selected') {
            <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ ({{ getSelectedCount() }})?</p>
          }
          <p class="warning-text">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" (click)="cancelDelete()">–û—Ç–º–µ–Ω–∞</button>
          <button class="btn btn-danger" (click)="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>
    </div>
  }
</div>