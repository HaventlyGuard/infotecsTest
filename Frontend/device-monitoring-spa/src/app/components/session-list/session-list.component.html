<div class="sessions-container">
  <div class="sessions-header">
    <div class="header-left">
      <h2>–°–µ—Å—Å–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
      <span class="device-id-badge">{{ deviceId | slice:0:8 }}...</span>
    </div>
    <div class="header-right">
      <button class="btn-refresh" (click)="refresh()" [disabled]="isLoading" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π">
        <span class="refresh-icon" [class.spinning]="isLoading">‚Üª</span>
        <span class="refresh-text">–û–±–Ω–æ–≤–∏—Ç—å</span>
      </button>
      <div class="pagination">
        <button class="btn-icon" (click)="prevPage()" [disabled]="filter.offset === 0 || isLoading">
          <span>‚Üê</span>
        </button>
        <span class="page-info">
          {{ getCurrentPage() }}/{{ getTotalPagesDisplay() }}
        </span>
        <button class="btn-icon" (click)="nextPage()" 
                [disabled]="(filter.offset + filter.limit) >= totalSessions || isLoading">
          <span>‚Üí</span>
        </button>
      </div>
    </div>
  </div>

  <div class="sessions-toolbar">
    <div class="selection-info" [class.has-selection]="getSelectedCount() > 0">
      <span *ngIf="getSelectedCount() === 0">–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π</span>
      <span *ngIf="getSelectedCount() > 0">–í—ã–±—Ä–∞–Ω–æ: {{ getSelectedCount() }}</span>
    </div>
    <div class="toolbar-actions">
      <button class="btn btn-outline" (click)="openDeleteModal('date')" [disabled]="isLoading">
        <span>üìÖ</span> –£–¥–∞–ª–∏—Ç—å –ø–æ –¥–∞—Ç–µ
      </button>
      <button class="btn btn-danger" (click)="openDeleteModal('selected')" 
              [disabled]="getSelectedCount() === 0 || isLoading">
        <span>üóëÔ∏è</span> –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ
      </button>
    </div>
  </div>

  <div class="sessions-table-container">
    <div *ngIf="isLoading" class="loading-overlay">
      <div class="spinner"></div>
    </div>

    <table class="sessions-table">
      <thead>
        <tr>
          <th style="width: 40px;">
            <input type="checkbox" 
                   [checked]="sessions.length > 0 && selectedSessionIds.size === sessions.length"
                   (change)="toggleAllSessions($event)"
                   [disabled]="sessions.length === 0 || isLoading">
          </th>
          <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
          <th>–ù–∞—á–∞–ª–æ</th>
          <th>–ö–æ–Ω–µ—Ü</th>
          <th>–í–µ—Ä—Å–∏—è</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let session of sessions" 
            [class.selected]="isSessionSelected(session)"
            [class.loading]="isLoading">
          <td>
            <input type="checkbox" 
                   [checked]="isSessionSelected(session)"
                   (change)="toggleSession(session.id)"
                   [disabled]="isLoading">
          </td>
          <td>
            <div class="user-info">
              <span class="user-avatar">{{ session.name.charAt(0).toUpperCase() }}</span>
              <span>{{ session.name }}</span>
            </div>
          </td>
          <td>{{ formatDate(session.startTime) }}</td>
          <td>{{ formatDate(session.endTime) }}</td>
          <td><span class="version-badge">{{ session.version }}</span></td>
        </tr>
        <tr *ngIf="sessions.length === 0 && !isLoading">
          <td colspan="5" class="empty-message">
            <p>–°–µ—Å—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="cancelDelete()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
        <button class="close-btn" (click)="cancelDelete()">√ó</button>
      </div>
      <div class="modal-body">
        <div *ngIf="deleteMode === 'date'" class="date-picker-group">
          <label>–£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏–∏ —Å—Ç–∞—Ä—à–µ –¥–∞—Ç—ã:</label>
          <input type="datetime-local" 
                 class="date-input"
                 [(ngModel)]="cleanupDate">
        </div>
        <div *ngIf="deleteMode === 'selected'">
          <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ ({{ getSelectedCount() }})?</p>
        </div>
        <p class="warning-text">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" (click)="cancelDelete()">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-danger" (click)="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>
  </div>
</div>